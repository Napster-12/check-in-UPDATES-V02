{% extends 'base.html' %}
{% block content %}
<style>
  body {
    background-color: #f4f6f8;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #1f2937;
    margin: 0;
    padding: 0;
  }

  .dashboard {
    padding: 40px;
    max-width: 1400px;
    margin: auto;
  }

  .title {
    text-align: center;
    margin-bottom: 40px;
    font-size: 2rem;
    font-weight: 600;
    color: #1f2937;
  }

  /* Filters */
  .filters {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 40px;
    justify-content: center;
  }

  .filters select {
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid #cbd5e1;
    background-color: #ffffff;
    color: #1f2937;
    font-size: 1rem;
    transition: all 0.2s;
  }

  .filters select:hover {
    border-color: #3b82f6;
  }

  /* KPI Cards */
  .stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }

  .card {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 25px;
    text-align: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.12);
  }

  .card h3 {
    font-size: 2rem;
    color: #3b82f6;
    margin-bottom: 10px;
  }

  .card p {
    font-size: 1rem;
    color: #475569;
  }

  /* Charts */
  .charts {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }

  .chart-container {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    flex: 1 1 300px; /* responsive width */
    max-width: 400px; /* reduced width */
    min-width: 300px;
  }

  .chart-container canvas {
    max-height: 250px; /* smaller chart height */
  }

  .chart-title {
    font-size: 1.1rem;
    font-weight: 500;
    color: #1f2937;
    margin-bottom: 10px;
    text-align: center;
  }

  @media(max-width: 1024px) {
    .charts {
      flex-direction: column;
      align-items: center;
    }
  }
</style>

<div class="dashboard">
  <h2 class="title">ðŸ“Š MICTSETA Mentor Dashboard</h2>

  <!-- Filters -->
  <div class="filters">
    <select id="institutionFilter">
      <option value="all">All Institutions</option>
      <option value="Vaal University of Technology">Vaal University of Technology</option>
      <option value="Tshwane University of Technology">Tshwane University of Technology</option>
      <option value="Moepi Publishing">Moepi Publishing</option>
    </select>

    <select id="studentFilter">
      <option value="all">All Students</option>
    </select>

    <select id="departmentFilter">
      <option value="all">All Departments</option>
      <option value="Data Science">Data Science</option>
      <option value="Multimedia">Multimedia</option>
      <option value="Development">Development</option>
    </select>

    <select id="monthFilter">
      <option value="all">All Months</option>
      <option value="1">January</option><option value="2">February</option>
      <option value="3">March</option><option value="4">April</option>
      <option value="5">May</option><option value="6">June</option>
      <option value="7">July</option><option value="8">August</option>
      <option value="9">September</option><option value="10">October</option>
      <option value="11">November</option><option value="12">December</option>
    </select>

    <select id="yearFilter">
      <option value="all">All Years</option>
      <option value="2024">2024</option>
      <option value="2025">2025</option>
    </select>
  </div>

  <!-- KPI Cards -->
  <div class="stats">
    <div class="card"><h3 id="mentorCount">2</h3><p>Total Mentors</p></div>
    <div class="card"><h3 id="studentCount">6</h3><p>Total Students</p></div>
    <div class="card"><h3 id="institutionCount">3</h3><p>Partner Institutions</p></div>
    <div class="card"><h3 id="checkInCount">12</h3><p>Total Check-Ins</p></div>
  </div>

  <!-- Charts aligned horizontally -->
  <div class="charts">
    <div class="chart-container">
      <div class="chart-title">Institution Distribution</div>
      <canvas id="institutionChart"></canvas>
    </div>

    <div class="chart-container">
      <div class="chart-title">Department Distribution</div>
      <canvas id="departmentChart"></canvas>
    </div>

    <div class="chart-container">
      <div class="chart-title">Department vs Number of Students</div>
      <canvas id="deptStudentChart"></canvas>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const data = [
  { name: 'Codnell Chabalala', institution: 'Vaal University of Technology', department: 'Data Science', month: 11, year: 2025, checkIns: 3 },
  { name: 'Naledi Nkgodi', institution: 'Tshwane University of Technology', department: 'Data Science', month: 10, year: 2025, checkIns: 2 },
  { name: 'Sandile Sibundeni', institution: 'Vaal University of Technology', department: 'Data Science', month: 11, year: 2024, checkIns: 1 },
  { name: 'Thando Nkuna', institution: 'Tshwane University of Technology', department: 'Multimedia', month: 9, year: 2025, checkIns: 3 },
  { name: 'Fortune Mathebula', institution: 'Tshwane University of Technology', department: 'Multimedia', month: 8, year: 2025, checkIns: 2 },
  { name: 'Masego Molefe', institution: 'Moepi Publishing', department: 'Development', month: 11, year: 2025, checkIns: 1 }
];

const institutionSelect = document.getElementById('institutionFilter');
const studentSelect = document.getElementById('studentFilter');
const deptSelect = document.getElementById('departmentFilter');
const monthSelect = document.getElementById('monthFilter');
const yearSelect = document.getElementById('yearFilter');

function updateStudentOptions(inst) {
  const names = inst === 'all' ? data.map(d => d.name) : data.filter(d => d.institution === inst).map(d => d.name);
  studentSelect.innerHTML = '<option value="all">All Students</option>';
  names.forEach(n => {
    const o = document.createElement('option');
    o.value = n; o.textContent = n;
    studentSelect.appendChild(o);
  });
}
updateStudentOptions('all');

const ctxInstitution = document.getElementById('institutionChart');
const ctxDept = document.getElementById('departmentChart');
const ctxDeptStudent = document.getElementById('deptStudentChart');

let institutionChart, departmentChart, deptStudentChart;

function renderCharts(filtered) {
  if (institutionChart) institutionChart.destroy();
  if (departmentChart) departmentChart.destroy();
  if (deptStudentChart) deptStudentChart.destroy();

  const instCounts = {}, deptCounts = {};
  filtered.forEach(s => {
    instCounts[s.institution] = (instCounts[s.institution] || 0) + 1;
    deptCounts[s.department] = (deptCounts[s.department] || 0) + 1;
  });

  const totalCheckIns = filtered.reduce((sum, s) => sum + s.checkIns, 0);
  document.getElementById('studentCount').textContent = filtered.length;
  document.getElementById('institutionCount').textContent = Object.keys(instCounts).length;
  document.getElementById('checkInCount').textContent = totalCheckIns;

  institutionChart = new Chart(ctxInstitution, {
    type: 'doughnut',
    data: { labels: Object.keys(instCounts), datasets: [{ data: Object.values(instCounts), backgroundColor: ['#3b82f6', '#f59e0b', '#10b981'] }] },
    options: { plugins: { legend: { labels: { color: '#1f2937' } } } }
  });

  departmentChart = new Chart(ctxDept, {
    type: 'bar',
    data: { labels: Object.keys(deptCounts), datasets: [{ label: 'Students', data: Object.values(deptCounts), backgroundColor: '#3b82f6' }] },
    options: { scales: { x: { ticks: { color: '#1f2937' } }, y: { beginAtZero: true, ticks: { color: '#1f2937' } } }, plugins: { legend: { labels: { color: '#1f2937' } } } }
  });

  deptStudentChart = new Chart(ctxDeptStudent, {
    type: 'bar',
    data: { labels: Object.keys(deptCounts), datasets: [{ label: 'Students per Department', data: Object.values(deptCounts), backgroundColor: '#f59e0b' }] },
    options: { scales: { x: { ticks: { color: '#1f2937' } }, y: { beginAtZero: true, ticks: { color: '#1f2937' } } }, plugins: { legend: { labels: { color: '#1f2937' } } } }
  });
}

function applyFilters() {
  const inst = institutionSelect.value;
  const stud = studentSelect.value;
  const dept = deptSelect.value;
  const month = monthSelect.value;
  const year = yearSelect.value;

  let filtered = data;
  if (inst !== 'all') filtered = filtered.filter(d => d.institution === inst);
  if (stud !== 'all') filtered = filtered.filter(d => d.name === stud);
  if (dept !== 'all') filtered = filtered.filter(d => d.department === dept);
  if (month !== 'all') filtered = filtered.filter(d => d.month == month);
  if (year !== 'all') filtered = filtered.filter(d => d.year == year);

  renderCharts(filtered);
}

[institutionSelect, studentSelect, deptSelect, monthSelect, yearSelect].forEach(sel =>
  sel.addEventListener('change', () => {
    if (sel === institutionSelect) updateStudentOptions(institutionSelect.value);
    applyFilters();
  })
);

renderCharts(data);
</script>
{% endblock %}
